@model MYFEELIB.Entities.RequireElements
@{
    ViewData["Title"] = "Time Table";
}

<style>
    table#DataTable {
        border-collapse: collapse;
        /*font-family: verdana, arial, sans-serif;*/
        font-size: 14px;
        line-height: 1.4em !important;
        border: 1px solid #363;
        table-layout: fixed;
        /*word-break: break-all;*/
        word-wrap: break-word;
    }

        table#DataTable TBODY TR TD:first-child {
            background-color: #bbe4e4;
            /*font-family: verdana, arial, sans-serif;*/
            font-weight: bold;
            line-height: 1.4;
            font-size: 15px;
            padding: 8px;
        }

        table#DataTable TBODY TR TD {
            height: 50px;
            vertical-align: middle;
        }



            table#DataTable TBODY TR TD a:link {
                background-color: yellow;
                text-align: center;
            }

            table#DataTable TBODY TR TD a:visited {
                background-color: cyan;
                text-align: center;
            }

            table#DataTable TBODY TR TD a:hover {
                background-color: lightgreen;
                text-align: center;
            }

            table#DataTable TBODY TR TD a:active {
                background-color: hotpink;
                text-align: center;
            }
</style>

<section id="" class="animated fadeInUp">
    <section class="fuelux" style="margin: 50px 50px;">

        <div class="step-content" style="margin-bottom: 0px; background: #fff; text-align: center; border-top: 1px solid #D4D4D4;">
            <div class="step-pane active" id="step1">

                <div class="col-md-offset-0 preauth_font  ">
                    <div class="clear" style="clear: both;"></div>

                    <div class="form-group col-sm-12 col-md-6 col-lg-4 text-left ">
                        @Html.LabelFor(m => m.Program, new { @class = "col-sm-12 control-label" })
                        <div class="col-sm-12">
                            @Html.DropDownListFor(m => m.Program, Model.Programs, "SELECT PROGRAM",
                                              new { @class = "form-control" })
                            @Html.ValidationMessageFor(m => m.Program, "", new { @class = "text-danger" })
                        </div>
                    </div>


                    <div class="form-group col-sm-12 col-md-6 col-lg-4 text-left ">
                        @Html.LabelFor(m => m.Course, new { @class = "col-sm-12 control-label" })
                        <div class="col-sm-12">
                            @Html.DropDownListFor(m => m.Course, Model.Courses, "SELECT COURSE",
                                              new { @class = "form-control" })
                            @Html.ValidationMessageFor(m => m.Course, "", new { @class = "text-danger" })
                        </div>
                    </div>


                    <div class="form-group col-sm-12 col-md-6 col-lg-4 text-left ">
                        @Html.LabelFor(m => m.Section, new { @class = "col-sm-12 control-label" })
                        <div class="col-sm-12">
                            @Html.DropDownListFor(m => m.Section, Model.Sections, "SELECT SECTION",
                                              new { @class = "form-control" })
                            @Html.ValidationMessageFor(m => m.Section, "", new { @class = "text-danger" })
                        </div>
                    </div>

                    <div class="form-group col-sm-12 col-md-6 col-lg-4 text-left ">
                        @Html.LabelFor(m => m.Year, new { @class = "col-sm-12 control-label" })
                        <div class="col-sm-12">
                            @Html.DropDownListFor(m => m.Year, Model.Years, "SELECT YEAR",
                                              new { @class = "form-control" })
                            @Html.ValidationMessageFor(m => m.Year, "", new { @class = "text-danger" })
                        </div>
                    </div>

                    <div class="form-group col-sm-12 col-md-6 col-lg-4 text-left ">
                        @Html.LabelFor(m => m.Semester, new { @class = "col-sm-12 control-label" })
                        <div class="col-sm-12">
                            @Html.DropDownListFor(m => m.Semester, Model.Semesters, "SELECT SEMESTER",
                                              new { @class = "form-control" })
                            @Html.ValidationMessageFor(m => m.Semester, "", new { @class = "text-danger" })
                        </div>
                    </div>


                    <div class="clearfix"></div>
                    <div align="center" style="width :100%">
                        <input type='hidden' id='fee_WV' name='fee_WV' value=''>
                        <table id="DataTable" style="width:100%;" class="table table-bordered">
                            <thead>

                            </thead>
                            <tbody></tbody>
                            <tfoot></tfoot>
                        </table>

                    </div>

                    <div id="TimeUpdate">

                        <div class="form-group col-sm-12 col-md-12 col-lg-6 text-left ">

                            <span id="RAB" class="col-sm-6 control-label">Select Week</span>
                            <div class="col-sm-6">
                                @Html.DropDownListFor(m => m.week, Model.weeks, "SELECT WEEK",
                          new { @class = "form-control" })

                            </div>
                        </div>

                        <div class="form-group col-sm-12 col-md-12 col-lg-6 text-left ">

                            <span id="RY" class="col-sm-6 control-label">Select Faculty</span>
                            <div class="col-sm-6">
                                @Html.DropDownListFor(m => m.Faculty1, Model.Faculties1, "SELECT FACULTY",
                          new { @class = "form-control" })

                            </div>
                        </div>
                        <div class="form-group col-sm-12 col-md-12 col-lg-6 text-left ">

                            <span id="RY" class="col-sm-6 control-label">Select Faculty 2</span>
                            <div class="col-sm-6">
                                @Html.DropDownListFor(m => m.Faculty2, Model.Faculties2, "SELECT FACULTY",
                          new { @class = "form-control" })

                            </div>
                        </div>

                        <div class="form-group col-sm-12 col-md-12 col-lg-6 text-left ">

                            <span id="RY" class="col-sm-6 control-label">Select Subject</span>
                            <div class="col-sm-6">
                                @Html.DropDownListFor(m => m.subject, Model.subjects, "SELECT SUBJECTS",
                          new { @class = "form-control" })

                            </div>
                        </div>



                        <div class="form-group col-sm-12 col-md-12 col-lg-6 text-left ">

                            @Html.LabelFor(m => m.NoofHours, new { @class = "col-sm-6 control-label" })
                            <div class="col-sm-6">
                                @*@Html.TextBoxFor(m => m.NoofHours, new { @class = "form-control", placeholder = "No of Hours", @readonly = "readonly" })
                                    @Html.ValidationMessageFor(m => m.NoofHours, "", new { @class = "text-danger" })*@
                                <input type='text' id='NoofHours' value='' name='NoofHours' class='form-control' readonly onkeypress='return isNumber(event)' />
                            </div>
                        </div>

                        <div class="form-group col-sm-12 col-md-12 col-lg-6 text-left ">


                            <div class="col-sm-6">
                                <input type="hidden" id="TimeId" name="TimeId" value="">
                            </div>
                        </div>



                    </div>




                    <div class="wizard col-sm-12">
                        <div class="pull-right" style="padding: 5px;">

                            <button type="submit" id="SaveAll" onclick="return confirm('Are you sure?')" class="btn btn-success btn-default">Submit</button>
                        </div>
                    </div>

                </div>



            </div>
            <div class="clearfix"></div>

        </div>

        <script>

            $(function () {

                $('#Program').change(function () {
                    //  debugger;
                    var id = $("#Program :selected").val();
                    if (id != "") {
                        $.ajax({
                            type: "GET",
                            contentType: "application/json; charset=utf-8",
                            url: '@Url.Action("FillCourse", "Enrollment")',
                            data: { "PId": id },
                            dataType: "json",
                            beforeSend: function () {
                                //alert(id);
                            },
                            success: function (data) {
                                var items = "";
                                $.each(data, function (i, Course) {
                                    items += "<option value='" + Course.Value + "'>" + Course.Text + "</option>";
                                });
                                $('#Course').html(items);

                            },
                            error: function (result) {

                                alert('Service call failed: ' + result.status + ' Type :' + result.statusText);
                            }
                        });
                    }
                    else {
                        var items = '<option value="">Select</option>';
                        $('#Course').html(items);
                    }
                });

            });


            $(function () {

                $('#Course').change(function () {
                    //  debugger;
                    var id = $("#Course :selected").val();
                    if (id != "") {
                        $.ajax({
                            type: "GET",
                            contentType: "application/json; charset=utf-8",
                            url: '@Url.Action("FillSection", "Enrollment")',
                            data: { "CId": id },
                            dataType: "json",
                            beforeSend: function () {
                                //alert(id);
                            },
                            success: function (data) {
                                var items = "";
                                $.each(data, function (i, Section) {
                                    items += "<option value='" + Section.Value + "'>" + Section.Text + "</option>";
                                });
                                $('#Section').html(items);

                            },
                            error: function (result) {

                                alert('Service call failed: ' + result.status + ' Type :' + result.statusText);
                            }
                        });
                    }
                    else {
                        var items = '<option value="">Select</option>';
                        $('#Section').html(items);
                    }
                });

            });


            $(function () {

                $('#Section').change(function () {
                    //  debugger;
                    var id = $("#Program :selected").val();
                    if (id != "") {
                        $.ajax({
                            type: "GET",
                            contentType: "application/json; charset=utf-8",
                            url: '@Url.Action("YearsList", "Academic")',
                            data: { "PId": id },
                            dataType: "json",
                            beforeSend: function () {
                                //alert(id);
                            },
                            success: function (data) {
                                var items = "";
                                $.each(data, function (i, yr) {
                                    items += "<option value='" + yr.Value + "'>" + yr.Text + "</option>";
                                });
                                $('#Year').html(items);

                            },
                            error: function (result) {

                                alert('Service call failed: ' + result.status + ' Type :' + result.statusText);
                            }
                        });
                    }
                    else {
                        var items = '<option value="">Select</option>';
                        $('#Year').html(items);
                    }
                });

            });

            $(function () {

                $('#Year').change(function () {
                    //  debugger;
                    var id = $("#Year :selected").val();
                    if (id != "") {
                        $.ajax({
                            type: "GET",
                            contentType: "application/json; charset=utf-8",
                            url: '@Url.Action("SemesterList", "Academic")',
                            data: { "YId": id },
                            dataType: "json",
                            beforeSend: function () {
                                //alert(id);
                            },
                            success: function (data) {
                                var items = "";
                                $.each(data, function (i, yr) {
                                    items += "<option value='" + yr.Value + "'>" + yr.Text + "</option>";
                                });
                                $('#Semester').html(items);

                            },
                            error: function (result) {

                                alert('Service call failed: ' + result.status + ' Type :' + result.statusText);
                            }
                        });
                    }
                    else {
                        var items = '<option value="">Select</option>';
                        $('#Semester').html(items);
                    }
                });

            });

        </script>

        <script>
            function isNumber(evt) {
                evt = (evt) ? evt : window.event;
                var charCode = (evt.which) ? evt.which : evt.keyCode;
                if (charCode > 31 && (charCode < 48 || charCode > 57)) {
                    return false;
                }
                return true;
            }
        </script>
        <script>
            $(document).ready(function () {
                $("#SaveAll").hide();
                $("#TimeUpdate").hide();

            });
            $(document).on('click', '.btnEdit', function () {
                var id = $(this).attr("data-value");
                $("#TimeId").val(id);

                var index = id.indexOf("-");
                if (index !== -1) {
                    var res = id.split("-");
                    $("#Faculty1").val("");
                    $("#Faculty2").val("");
                    $("#subject").val("");
                    $("#week").val(res[0])
                    $("#NoofHours").val("")
                    $("#NoofHours").prop("readonly", false);
                } else {
                    // alert("Substring not found!");
                    if (id != "") {
                        $("#loaderDiv").show();
                        $.ajax({
                            type: "GET",
                            contentType: "application/json; charset=utf-8",
                            url: '@Url.Action("GetTimeDetails", "Academic")',
                            data: { "Param": id },
                            dataType: "json",
                            beforeSend: function () {

                            },
                            success: function (data) {
                                var res = data.split("/");
                                $("#Faculty1").val(res[0]);
                                if (res[5] != 0) {
                                    $("#Faculty2").val(res[5]);
                                }
                                else {
                                    $("#Faculty2").val("");
                                }

                                $("#subject").val(res[1]);
                                $("#week").val(res[2])
                                $("#NoofHours").val(res[4])
                                $("#NoofHours").prop("readonly", false);
                            },
                            error: function (result) {

                                alert("Data Not Available check it !");
                            }
                        });
                        $("#loaderDiv").hide();
                    }
                    else {
                        $("#DataTable tr").remove();

                    }
                }

                $("#SaveAll").show();
                $("#TimeUpdate").show();

            });


            $(function () {
                $('#Semester').change(function () {
                    // debugger;
                    $("#DataTable tr").remove();
                    var prm = $("#Program :selected").val() + '/' + $("#Course :selected").val() + '/' + $("#Section :selected").val() + '/' + $("#Year :selected").val() + '/' + $("#Semester :selected").val()
                    var id = $("#Semester :selected").val();
                    if (id != "") {
                        $("#loaderDiv").show();
                        $.ajax({
                            type: "GET",
                            contentType: "application/json; charset=utf-8",
                            url: '@Url.Action("TimeTableRecords", "Academic")',
                            data: { "Semester": prm },
                            dataType: "json",
                            beforeSend: function () {

                            },
                            success: function (data) {



                                var markup = "<tr><th width='15%'>Day / Hour</th><th width='15%'>9:00 To 10:00</th><th width='15%'>10:00 To 11:00</th><th width='15%'>11:00 To 12:00</th><th width='15%' align='right'>12:00 To 13:00</th><th align='right' width='15%'>14:00 To 15:00</th><th width='15%' align='right'>15:00 To 16:00</th><th width='15%' align='right'>16:00 To 17:00</th></tr>";
                                $("#DataTable > thead").append(markup);
                                var markupfooter;
                                $.each(data, function (i, Rec) {
                                    var resone = Rec.One.split("/");
                                    var resTwo = Rec.Two.split("/");
                                    var resthree = Rec.three.split("/");
                                    var resFour = Rec.Four.split("/");
                                    var resFive = Rec.Five.split("/");
                                    var resSix = Rec.Six.split("/");
                                    var resSeven = Rec.Seven.split("/");
                                    var markup = "<tr><td width='15%'>" + Rec.SNo + "</td><td width='15%'><a data-value=" + resone[0] + " href='javascript:void(0)' class='btnEdit'>" + resone[1] + "/" + resone[2] + "</a></td><td width='15%'><a data-value=" + resTwo[0] + " href='javascript:void(0)' class='btnEdit'>" + resTwo[1] + "/" + resTwo[2] + "</a></td><td width='15%'><a data-value=" + resthree[0] + " href='javascript:void(0)' class='btnEdit'>" + resthree[1] + "/" + resthree[2] + "</a></td><td width='15%'><a data-value=" + resFour[0] + " href='javascript:void(0)' class='btnEdit'>" + resFour[1] + "/" + resFour[2] + "</a></td><td width='15%'><a data-value=" + resFive[0] + " href='javascript:void(0)' class='btnEdit'>" + resFive[1] + "/" + resFive[2] + "</a></td><td width='15%'><a data-value=" + resSix[0] + " href='javascript:void(0)' class='btnEdit'>" + resSix[1] + "/" + resSix[2] + "</a></td><td width='15%'><a data-value=" + resSeven[0] + " href='javascript:void(0)' class='btnEdit'>" + resSeven[1] + "/" + resSeven[2] + "</a></td></tr>";
                                    $("#DataTable > tbody").append(markup);


                                });

                            },
                            error: function (result) {

                                alert("Data Not Available check it !");


                            }
                        });

                        //Subject
                        $.ajax({
                            type: "GET",
                            contentType: "application/json; charset=utf-8",
                            url: '@Url.Action("FillSubject", "Academic")',
                            data: { "Prm": prm },
                            dataType: "json",
                            beforeSend: function () {

                            },
                            success: function (data) {

                                var items = "";
                                $.each(data, function (i, sub) {
                                    items += "<option value='" + sub.Value + "'>" + sub.Text + "</option>";
                                });
                                $('#subject').html(items);


                            },
                            error: function (result) {
                                alert("Data Not Available check it !");
                                var items = '<option value="">SELECT SUBJECT</option>';
                                $('#subject').html(items);
                            }
                        });
                        //end Subject
                    }
                    else {
                        $("#DataTable tr").remove();
                    }

                    $("#loaderDiv").hide();
                });

            });


        </script>
        <script type="text/jscript">


            $(document).on("click", "#SaveAll", function () {

                if ($("#Program :selected").val() == "") {
                    alert("Please Select Program !");
                    return;
                }
                if ($("#Course :selected").val() == "") {
                    alert("Please Select Program !");
                    return;
                }
                if ($("#Section :selected").val() == "") {
                    alert("Please Select Program !");
                    return;
                }
                if ($("#Year :selected").val() == "") {
                    alert("Please Select Program !");
                    return;
                }
                if ($("#Semester :selected").val() == "") {
                    alert("Please Select Program !");
                    return;
                }
                if ($("#subject :selected").val() == "") {
                    alert("Please Select Subject !");
                    return;
                }
                if ($("#Faculty1 :selected").val() == "") {
                    alert("Please Select Faculty !");
                    return;
                }

                // var CheckAll = $("#subject :selected").val() + '/' + $("#Faculty1 :selected").val() + '/' + $("#TimeId").val() + '/' + $("#NoofHours").val()
                $("#loaderDiv").show();

                var TimeUpdate = new Array();
                var req = {};
                req.TimeId = $("#TimeId").val();
                req.subject = $("#subject :selected").val();
                req.Faculty1 = $("#Faculty1 :selected").val();
                req.NoofHours = $("#NoofHours").val();

                req.Program = $("#Program :selected").val();
                req.Course = $("#Course :selected").val();
                req.Section = $("#Section :selected").val();
                req.Year = $("#Year :selected").val();
                req.Semester = $("#Semester :selected").val();
                req.Course = $("#Course :selected").val();

                if ($("#Faculty2 :selected").val() != "") {
                    req.Faculty2 = $("#Faculty2 :selected").val();

                }



                TimeUpdate.push(req);
                TimeUpdate = JSON.stringify({ 'TimeUpdates': TimeUpdate });


                $.ajax({
                    type: "POST",
                    contentType: "application/json; charset=utf-8",
                    url: '@Url.Action("TimeTableUpdate", "Academic")',
                    data: TimeUpdate,
                    dataType: "json",
                    success: function (r) {

                        if (r == 0) {

                            alert("Time Has Not Updated!");
                            $("#SaveAll").hide();
                        }
                        else {
                            if (r == 1) {
                                alert("Time Has Updated!");

                                //Refresh Time Table
                                // debugger;
                                $("#DataTable tr").remove();
                                var prm = $("#Program :selected").val() + '/' + $("#Course :selected").val() + '/' + $("#Section :selected").val() + '/' + $("#Year :selected").val() + '/' + $("#Semester :selected").val()
                                var id = $("#Semester :selected").val();
                                if (id != "") {
                                    $("#loaderDiv").show();
                                    $.ajax({
                                        type: "GET",
                                        contentType: "application/json; charset=utf-8",
                                        url: '@Url.Action("TimeTableRecords", "Academic")',
                                        data: { "Semester": prm },
                                        dataType: "json",
                                        beforeSend: function () {

                                        },
                                        success: function (data) {
                                            var markup = "<tr><th width='15%'>Day / Hour</th><th width='15%'>9:00 To 10:00</th><th width='15%'>10:00 To 11:00</th><th width='15%'>11:00 To 12:00</th><th width='15%' align='right'>12:00 To 13:00</th><th align='right' width='15%'>14:00 To 15:00</th><th width='15%' align='right'>15:00 To 16:00</th><th width='15%' align='right'>16:00 To 17:00</th></tr>";
                                            $("#DataTable > thead").append(markup);
                                            var markupfooter;
                                            $.each(data, function (i, Rec) {
                                                var resone = Rec.One.split("/");
                                                var resTwo = Rec.Two.split("/");
                                                var resthree = Rec.three.split("/");
                                                var resFour = Rec.Four.split("/");
                                                var resFive = Rec.Five.split("/");
                                                var resSix = Rec.Six.split("/");
                                                var resSeven = Rec.Seven.split("/");
                                                var markup = "<tr><td width='15%'>" + Rec.SNo + "</td><td width='15%'><a data-value=" + resone[0] + " href='javascript:void(0)' class='btnEdit'>" + resone[1] + "/" + resone[2] + "</a></td><td width='15%'><a data-value=" + resTwo[0] + " href='javascript:void(0)' class='btnEdit'>" + resTwo[1] + "/" + resTwo[2] + "</a></td><td width='15%'><a data-value=" + resthree[0] + " href='javascript:void(0)' class='btnEdit'>" + resthree[1] + "/" + resthree[2] + "</a></td><td width='15%'><a data-value=" + resFour[0] + " href='javascript:void(0)' class='btnEdit'>" + resFour[1] + "/" + resFour[2] + "</a></td><td width='15%'><a data-value=" + resFive[0] + " href='javascript:void(0)' class='btnEdit'>" + resFive[1] + "/" + resFive[2] + "</a></td><td width='15%'><a data-value=" + resSix[0] + " href='javascript:void(0)' class='btnEdit'>" + resSix[1] + "/" + resSix[2] + "</a></td><td width='15%'><a data-value=" + resSeven[0] + " href='javascript:void(0)' class='btnEdit'>" + resSeven[1] + "/" + resSeven[2] + "</a></td></tr>";
                                                $("#DataTable > tbody").append(markup);


                                            });

                                        },
                                        error: function (result) {

                                            alert("Data Not Available check it !");


                                        }
                                    });
                                }
                                else {
                                    $("#DataTable tr").remove();
                                }

                                $("#loaderDiv").hide();
                                //End Refresh Time Table

                            }
                            $("#SaveAll").hide();
                            $("#Faculty1").val("");
                            $("#Faculty2").val("");
                            $("#subject").val("");
                            $("#week").val("");
                            $("#NoofHours").val("");
                            $("#NoofHours").prop("readonly", false);
                            $("#TimeUpdate").hide();
                        }
                    }
                });
                $("#loaderDiv").hide();
            });
        </script>

    </section>

</section>